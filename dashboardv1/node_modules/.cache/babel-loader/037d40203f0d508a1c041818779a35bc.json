{"ast":null,"code":"var _jsxFileName = \"/home/danielo/Development/ui/dashboardV1/src/Mint.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useContext, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport MOLCOMMONS_ABI from './MOLCOMMONS_ABI';\nimport { ethers } from 'ethers';\nimport { CommunityContext } from './GlobalContext';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Mint = ({\n  metadata,\n  sale,\n  ethPrice,\n  coinPrice,\n  img\n}) => {\n  _s();\n\n  // ----- useContext\n  const {\n    commons\n  } = useContext(CommunityContext);\n  const [imageHash, setImageHash] = useState('');\n  const [imageUrl, setImageUrl] = useState('profile.jpg'); // ----- Reaect Router Config\n\n  const history = useHistory(); // ----- Smart Contract Config\n\n  const provider = new ethers.providers.Web3Provider(window.ethereum, 'any');\n  const signer = provider.getSigner(); // ----- Upload image to Fleek Storage\n\n  const upload = async (data, contract) => {\n    const url = `https://api.pinata.cloud/pinning/pinFileToIPFS`; //let   data = new FormData();\n    //data.append(\"file\", selectedFile, selectedFile.name );\n\n    const res = await axios.post(url, data, {\n      maxContentLength: \"Infinity\",\n      headers: {\n        \"Content-Type\": `multipart/form-data; boundary=${data._boundary}`,\n        pinata_api_key: process.env.REACT_APP_PINATA_PUBLIC,\n        pinata_secret_api_key: process.env.REACT_APP_PINATA_PRIVATE\n      }\n    });\n    console.log(res.data);\n    setImageHash(res.data.IpfsHash);\n    setImageUrl('https://gateway.pinata.cloud/ipfs/' + res.data.IpfsHash);\n    /*  const input = {\n        apiKey: process.env.REACT_APP_FLEEK_API_KEY,\n        apiSecret: process.env.REACT_APP_FLEEK_API_SECRET,\n        bucket: 'audsssy-team-bucket',\n        key: metadata.title,\n        data,\n      }*/\n\n    try {\n      //const result = await fleek.upload(input)\n      //console.log('this is image hash from fleek - ' + result.hash)\n      // Prepare to mint NFT\n      uploadAndMint(res.data.IpfsHash);\n    } catch (e) {\n      console.log('error is - ' + e);\n    }\n  }; // ----- Upload tokenURI and Mint NFT\n\n\n  const uploadAndMint = async hash => {\n    const baseUrl = 'https://ipfs.io/ipfs/'; // Add timestamp to metadata\n\n    const date = new Date();\n    const timestamp = date.getTime();\n    const dict = { ...metadata,\n      image: baseUrl + hash,\n      createdAt: timestamp\n    };\n    console.log('tokenURI at mint is - ', dict);\n    alert('tokenURI at mint is - ', dict);\n    /*  const data = JSON.stringify(dict)\n      const i = {\n        apiKey: process.env.REACT_APP_FLEEK_API_KEY,\n        apiSecret: process.env.REACT_APP_FLEEK_API_SECRET,\n        bucket: 'audsssy-team-bucket',\n        key: hash,\n        data,\n      }\n    */\n\n    try {\n      // Uplaod tokenUri to Fleek\n      //    const result = await fleek.upload(i)\n      //    console.log('this is tokenUri hash from fleek - ' + result.hash)\n      // Mint NFT\n      const tokenUri = baseUrl + hash;\n      console.log(tokenUri);\n      const p = ethers.utils.parseEther(ethPrice);\n      const c = ethers.utils.parseEther(coinPrice);\n      molCommons(p, c, tokenUri);\n    } catch (e) {\n      console.log('error is - ' + e);\n    }\n  }; // ----- Mint Gamma with MolVault\n\n\n  const molCommons = async (price, coins, tokenURI) => {\n    console.log('MolVault contract is - ', commons);\n\n    const _contract = new ethers.Contract(commons, MOLCOMMONS_ABI, signer);\n\n    try {\n      const tx = await _contract.mint(price, coins, tokenURI, sale);\n      console.log('tx.hash for minting - ' + tx.hash);\n      tx.wait().then(receipt => {\n        if (receipt.confirmations === 1) {\n          console.log('mint receipt is - ', receipt);\n          history.push(`/community`); // Store user address to Firestore\n\n          addMinterToCoinHolders();\n        }\n      });\n    } catch (e) {\n      console.log(e);\n    }\n  }; // ----- Listen to contract events\n  // function contractListener(contract) {\n  //   contract.on('Transfer', (from, to, tokenId) => {\n  //     console.log('Token minted - ', from, to)\n  //     console.log('NFT tokenId minted - ' + tokenId)\n  //   })\n  //   contract.on('gRoyaltiesMinted', (contractAddress) => {\n  //     console.log('gRoyalties minted at contract address  - ', contractAddress)\n  //   })\n  // }\n  // Add minter to Firestore\n\n\n  const addMinterToCoinHolders = async () => {\n    console.log(commons);\n    const docRef = projectFirestore.collection('vault').doc(commons);\n    signer.getAddress().then(address => {\n      console.log(address);\n      docRef.update({\n        holders: firebaseFieldValue.arrayUnion(address)\n      });\n    });\n  };\n\n  useEffect(() => {\n    upload(img); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 10\n  }, this);\n};\n\n_s(Mint, \"rDcu6njjGLbIq4RiS6fREUasfUE=\", false, function () {\n  return [useHistory];\n});\n\n_c = Mint;\nexport default Mint;\n\nvar _c;\n\n$RefreshReg$(_c, \"Mint\");","map":{"version":3,"sources":["/home/danielo/Development/ui/dashboardV1/src/Mint.js"],"names":["React","useEffect","useContext","useState","useHistory","MOLCOMMONS_ABI","ethers","CommunityContext","axios","Mint","metadata","sale","ethPrice","coinPrice","img","commons","imageHash","setImageHash","imageUrl","setImageUrl","history","provider","providers","Web3Provider","window","ethereum","signer","getSigner","upload","data","contract","url","res","post","maxContentLength","headers","_boundary","pinata_api_key","process","env","REACT_APP_PINATA_PUBLIC","pinata_secret_api_key","REACT_APP_PINATA_PRIVATE","console","log","IpfsHash","uploadAndMint","e","hash","baseUrl","date","Date","timestamp","getTime","dict","image","createdAt","alert","tokenUri","p","utils","parseEther","c","molCommons","price","coins","tokenURI","_contract","Contract","tx","mint","wait","then","receipt","confirmations","push","addMinterToCoinHolders","docRef","projectFirestore","collection","doc","getAddress","address","update","holders","firebaseFieldValue","arrayUnion"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext, useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport MOLCOMMONS_ABI from './MOLCOMMONS_ABI'\nimport { ethers } from 'ethers'\nimport { CommunityContext } from './GlobalContext'\nimport axios from 'axios';\n\n\nconst Mint = ({ metadata, sale, ethPrice, coinPrice, img }) => {\n  // ----- useContext\n  const { commons } = useContext(CommunityContext)\n  const [imageHash, setImageHash] = useState('');\n  const [imageUrl, setImageUrl] = useState('profile.jpg');\n  \n  // ----- Reaect Router Config\n  const history = useHistory()\n\n  // ----- Smart Contract Config\n  const provider = new ethers.providers.Web3Provider(window.ethereum, 'any')\n  const signer = provider.getSigner()\n\n  // ----- Upload image to Fleek Storage\n  const upload = async (data, contract) => {\n\n    const url = `https://api.pinata.cloud/pinning/pinFileToIPFS`;\n    //let   data = new FormData();\n    //data.append(\"file\", selectedFile, selectedFile.name );\n    const res = await axios.post( url, data, {  maxContentLength: \"Infinity\", \n                                                headers: { \"Content-Type\": `multipart/form-data; boundary=${data._boundary}`,\n                                                            pinata_api_key: process.env.REACT_APP_PINATA_PUBLIC,\n                                                            pinata_secret_api_key: process.env.REACT_APP_PINATA_PRIVATE,            },\n                                              });\n    console.log(res.data);\n    setImageHash( res.data.IpfsHash );\n    setImageUrl( 'https://gateway.pinata.cloud/ipfs/' + res.data.IpfsHash );\n\n\n  /*  const input = {\n      apiKey: process.env.REACT_APP_FLEEK_API_KEY,\n      apiSecret: process.env.REACT_APP_FLEEK_API_SECRET,\n      bucket: 'audsssy-team-bucket',\n      key: metadata.title,\n      data,\n    }*/\n\n    try {\n      //const result = await fleek.upload(input)\n      //console.log('this is image hash from fleek - ' + result.hash)\n      // Prepare to mint NFT\n\n            uploadAndMint(res.data.IpfsHash)\n        } \n        catch (e) { console.log('error is - ' + e) }\n  }\n\n  // ----- Upload tokenURI and Mint NFT\n  const uploadAndMint = async (hash) => {\n    const baseUrl = 'https://ipfs.io/ipfs/'\n\n    // Add timestamp to metadata\n    const date = new Date()\n    const timestamp = date.getTime()\n    const dict = { ...metadata, image: baseUrl + hash, createdAt: timestamp }\n    console.log('tokenURI at mint is - ', dict)\n    alert('tokenURI at mint is - ', dict)\n\n  /*  const data = JSON.stringify(dict)\n    const i = {\n      apiKey: process.env.REACT_APP_FLEEK_API_KEY,\n      apiSecret: process.env.REACT_APP_FLEEK_API_SECRET,\n      bucket: 'audsssy-team-bucket',\n      key: hash,\n      data,\n    }\n*/\n    try {\n      // Uplaod tokenUri to Fleek\n  //    const result = await fleek.upload(i)\n  //    console.log('this is tokenUri hash from fleek - ' + result.hash)\n\n      // Mint NFT\n      const tokenUri = baseUrl + hash\n      console.log(tokenUri)\n      const p = ethers.utils.parseEther(ethPrice)\n      const c = ethers.utils.parseEther(coinPrice)\n      molCommons(p, c, tokenUri)\n  \n    } catch (e) {\n      console.log('error is - ' + e )\n    }\n  }\n\n  // ----- Mint Gamma with MolVault\n  const molCommons = async (price, coins, tokenURI) => {\n    console.log('MolVault contract is - ', commons)\n    const _contract = new ethers.Contract(commons, MOLCOMMONS_ABI, signer)\n    try {\n      const tx = await _contract.mint(price, coins, tokenURI, sale)\n      console.log('tx.hash for minting - ' + tx.hash)\n\n      tx.wait().then((receipt) => {\n        if (receipt.confirmations === 1) {\n          console.log('mint receipt is - ', receipt)\n          history.push(`/community`)\n\n          // Store user address to Firestore\n          addMinterToCoinHolders()\n        }\n      })\n    } catch (e) {\n      console.log(e)\n    }\n  }\n\n  // ----- Listen to contract events\n  // function contractListener(contract) {\n  //   contract.on('Transfer', (from, to, tokenId) => {\n  //     console.log('Token minted - ', from, to)\n  //     console.log('NFT tokenId minted - ' + tokenId)\n  //   })\n\n  //   contract.on('gRoyaltiesMinted', (contractAddress) => {\n  //     console.log('gRoyalties minted at contract address  - ', contractAddress)\n  //   })\n  // }\n\n  // Add minter to Firestore\n  const addMinterToCoinHolders = async () => {\n    console.log(commons)\n    const docRef = projectFirestore.collection('vault').doc(commons)   \n    \n    signer.getAddress().then(address => {\n      console.log(address)\n       docRef.update({\n         holders: firebaseFieldValue.arrayUnion(address),\n       }) \n    })\n  }\n\n  useEffect(() => {\n    upload(img)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  return <div></div>\n}\n\nexport default Mint\n"]},"metadata":{},"sourceType":"module"}